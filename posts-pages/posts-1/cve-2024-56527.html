<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <title>CVE-2024–56527</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.9.0/styles/github-dark.min.css">

  
  <link rel="stylesheet" href="../../static/css/common.css">

 
  <link rel="stylesheet" href="../../static/css/pages.css">
</head>
<body>
<header>
    <nav class="main-nav">
      <ul>
        <li><a href="../../index.html">Home</a></li>
        <li><a href="../posts-page-1.html" aria-current="page">Blog</a></li>
        <li><a href="../../cv.pdf">CV</a></li>
      </ul>
    </nav>
    </header>
    <main class="post-wrapper">
    <h1 class="post-title">CVE-2024–56527</h1>
    <div class="post-meta">
      <span><i class="fa-regular fa-calendar"></i>December 27, 2024</span>
      
    </div>

    <figure>
      <img src="../../static/images/tcpdf.png" alt="SAS CTF banner" style="width: 9rem; height: auto;">
    </figure>
	
	<article class="post-content">
	<p>During a penetration test for one of my clients, I managed to discover my first CVE in <strong>TCPDF</strong> a popular PHP library used to generate PDFs.</p>
	<hr>
	<br>
	<p>The library includes an <code>Error</code> function designed to handle and display error messages when issues arise during PDF generation.</p>
	
	<p>However, in versions prior to <code>6.8.0</code> this function does not adequately sanitize error messages before rendering them.</p>
	<pre><code class="language-php">public function Error($msg) {
    // unset all class variables
    $this->_destroy(true);
    if (defined('K_TCPDF_THROW_EXCEPTION_ERROR') AND !K_TCPDF_THROW_EXCEPTION_ERROR) {
        die('<strong>TCPDF ERROR: </strong>'.$msg); // No sanitization
    } else {
        throw new Exception('TCPDF ERROR: '.$msg);
    }
}
</code></pre>
<p>This is a serious problem because if a user is able to trigger an error containing their input it could lead to an <code>XSS</code> vulnerability.</p>
<p>For example, suppose that an attacker is able to choose the font of their PDF.</p>
<p>If the attacker inserts something like <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> as the font, the <strong>setFont</strong> function will throw an error (since the font does not exist) and will consequently call the <strong>Error</strong> function, which will insecurely display the error containing the name of the non-existent font.</p>
<p>Example of a vulnerable code:</p>
<pre><code class="language-php">require_once('tcpdf.php');


$font = $_GET['font'];


$pdf = new TCPDF();

$pdf->SetFont($font, '', 12);


$pdf->Output('output.pdf', 'I');

</code></pre>
<p>The vulnerability has been fixed in version 6.8.0 by sanitizing the data with the <code>htmlspecialchars()</code> function.</p>
<pre><code class="language-php">public function Error($msg) {
    // unset all class variables
    $this->_destroy(true);
    $msg = htmlspecialchars($msg, ENT_QUOTES, 'UTF-8');
    if (defined('K_TCPDF_THROW_EXCEPTION_ERROR') AND !K_TCPDF_THROW_EXCEPTION_ERROR) {
        die('<strong>TCPDF ERROR: </strong>'.$msg);
    } else {
        throw new Exception('TCPDF ERROR: '.$msg);
    }
}
</code></pre>
	</article>
	</main>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
	<script>hljs.highlightAll();</script>
	<body>
	</html>
